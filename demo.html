<!DOCTYPE html> 
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"> 
<head> 
	<meta http-equiv="content-type" content="text/html;charset=utf-8" /> 
	<title>NetMusician Resizer Demo</title>
	<script type='text/javascript' src='http://yui.yahooapis.com/3.5.0/build/yui/yui-min.js'></script>	
	<script type="text/javascript" src="nmresizer.js"></script>
	<script type="text/javascript">
	YUI.add('gallery-nmresizer', function(Y){    
	    Y.Nmresizer = Y.Base.create('nmresizer', Y.Widget, [], { 
			initializer : function( config ) {

			},

			loadAndResize : function(config) {
				// check for required parameters
				if (typeof config.newdiv == "undefined") {
					Y.log('nmresizer requires a "newdiv" parameter', 'error');
					return;
				}
				else if (typeof config.resizediv == "undefined") {
					Y.log('nmresizer requires a "resizediv" parameter', 'error');
					return;
				}

				if (!config.olddiv.match(/^(#|\.)/)) {
					// CSS class or ID not specified, default to ID
					config.olddiv = '#' + config.olddiv;
				}
				if (!config.newdiv.match(/^(#|\.)/)) {
					// CSS class or ID not specified, default to ID
					config.newdiv = '#' + config.newdiv;
				}
				if (typeof config.animDuration !== "undefined") {
					// use provided animDuration, overriding default
					this.set('animDuration', config.animDuration);
				}
				if (typeof config.maxWidth !== "undefined") {
					this.set('maxWidth', config.maxWidth);
				}
				if (typeof config.maxHeight !== "undefined") {
					this.set('maxHeight', config.maxHeight);
				}
				if (typeof config.offsetWidth !== "undefined") {
					this.set('offsetWidth', config.offsetWidth);
				}
				if (typeof config.offsetHeight !== "undefined") {
					this.set('offsetHeight', config.offsetHeight);
				}

				config.resizediv = config.resizediv ? config.resizediv : config.newdiv;

				// determine current tab dimensions
				config.oldtabheight = Y.one(config.resizediv).getComputedStyle('height');
				config.oldtabwidth = Y.one(config.resizediv).getComputedStyle('width');

				// delay measurement until all images in config.newdiv have been loaded
				if (Y.one(config.newdiv + ' img')) {
					var totalimages = Y.all(config.newdiv + ' img').size();
					var imagesloaded = 0;
					var images = [];
					var nmresizer = this;
					Y.all(config.newdiv + ' img').each(function(o,idx) {
						if (o.get('src') && o.get('src').match(/\.(jpg|jpeg|gif|png)$/i)) {
							images[idx] = new Image();
							images[idx].src = o.get('src');
							images[idx].onload = function() {
								//o.set('src', images[idx].src);
								imagesloaded++;
								if (imagesloaded == totalimages) {
									nmresizer.doLoadAndResize(config);
								}
							};
							images[idx].onerror = function() {
								// image load attempted, record it (perhaps image didn't exist in path)
								imagesloaded++;
								if (imagesloaded == totalimages) {
									nmresizer.doLoadAndResize(config);
								}
							};	
						}
						else {
							totalimages--;
							if (!totalimages) { this.doLoadAndResize(config); }
						}
					}, this);
				}
				else {
					this.doLoadAndResize(config);
				}
			},

			doLoadAndResize : function(config) {
				Y.one(config.newdiv).setStyles({
					display:'block',
					position:'absolute',
					left:'-5000px',
					visibility:'hidden'
				});
				Y.one(config.newdiv).removeClass('displaynone');

				if (typeof config.noWidthResize == "undefined") {
					// resize width
					config.newtabwidth = Y.one(config.newdiv).get('offsetWidth') + this.get('offsetWidth') + 'px';
					if (this.get('maxWidth') && parseInt(config.newtabwidth, 10) > this.get('maxWidth')) {
						config.newtabwidth = this.get('maxWidth') + 'px';
					}
				}

				if (typeof config.noHeightResize == "undefined") {
					// resize height
					config.newtabheight = Y.one(config.newdiv).get('offsetHeight') + this.get('offsetHeight') + 'px';
					if (this.get('maxHeight') && parseInt(config.newtabheight, 10) > this.get('maxHeight')) {
						config.newtabheight = this.get('maxHeight') + 'px';
					}
				}

				Y.log('newtabwidth: ' + config.newtabwidth + ' newtabheight: ' + config.newtabheight);

				// return newdiv to viewport
				Y.one(config.newdiv).setStyles({
					position:'',
					left:''
				});

				Y.one(config.resizediv).setStyles({
					width:config.oldtabwidth,
					height:config.oldtabheight
				});

				if (config.onStart) {
					config.onStart(config);
				}

				// hide olddiv
				if (config.olddiv !== config.newdiv) {
					Y.one(config.olddiv).setStyles({
						display:'none',
						width:'',
						height:''
					});	
				}

				// start transition
				if ((config.oldtabheight == config.newtabheight && config.oldtabwidth == config.newtabwidth) || config.olddiv == config.newdiv) {
					// no transition necessary, just show new element
					Y.one(config.newdiv).setStyles({
						display:'block',
						visibility:'visible'
					});
					if (config.resizediv !== config.newdiv) {
						Y.one(config.newdiv).setStyles({
							width:'auto',
							height:'auto'
						});
					}
					if (config.onEnd) {
						config.onEnd(config);
					}
				}
				else {
					var transoptions = {
						easing:'ease-out',
						duration:this.get('animDuration')
					};

					if (typeof config.newtabwidth !== "undefined") {
						transoptions.width = config.newtabwidth;
					}
					if (typeof config.newtabheight !== "undefined") {
						transoptions.height = config.newtabheight;
					}

					// animate resizediv to fit config.newdiv
					Y.all(config.resizediv).transition(transoptions, function() {
						// release inline dimension restraints
						Y.one(config.resizediv).setStyles({
							width:'',
							height:''
						});
						// reveal contents
						Y.one(config.newdiv).setStyles({
							visibility:'visible'
						});
						if (config.resizediv !== config.newdiv) {
							Y.one(config.newdiv).setStyles({
								width:'auto',
								height:'auto'
							});
						}
						if (config.onEnd) {
							config.onEnd(config);
						}
					});
				}
			}
		}, {
	        ATTRS : { 
				animDuration : {
					value : 0.5
				},
				maxHeight : {
					value : 0
				},
				maxWidth : {
					value : 0
				},
				offsetWidth : {
					value : 0
				},
				offsetHeight : {
					value : 0
				}
			}

		});

	}, '0.1', {requires: ['base-build', 'widget', 'node', 'transition']});
	
	YUI().use('gallery-nmresizer', 'event-delegate', 'node', function(Y) {
		Y.delegate('click', function(e) {
			e.preventDefault();
			var nextthing = this.get('id').replace(/^showthing/,'');
			var thisthing;
			Y.all('#thingwrapper .thing').some(function(node) {
				if (!node.hasClass('displaynone') && node.getStyle('display') !== "none") {
					thisthing = node.get('id').replace(/^thing/,'');
					return;
				}
			});
			var nmresizer = new Y.Nmresizer();
			nmresizer.loadAndResize({
				olddiv:'#thing' + thisthing,
				newdiv:'#thing' + nextthing,
				animDuration:0.5,
				resizediv:'#thingwrapper',
				maxWidth:Y.one('body').get('winWidth') - 40,
				maxHeight:Y.one('body').get('winHeight') - 40,
				offsetHeight:0,
				offsetWidth:0,
				onStart:Y.bind(beforeResize),
				onEnd:Y.bind(afterResize)
			});
		}, '#navwrapper', 'a');
		
		function beforeResize(config) {
			Y.one('#navwrapper #progress').setContent('Loading...');
			Y.one('#thingwrapper').setStyles({
				opacity:'0.5',
				backgroundColor:'gray'
			});
		}
		
		function afterResize(config) {
			Y.one('#thingwrapper').setStyle('opacity', '');
			switch (config.newdiv) {
				case '#thing1':
				Y.one(document.body).setStyle('background-color', 'black');
				break;
				
				case '#thing2':
				Y.one(document.body).setStyle('background-color', 'orange');
				break;
				
				case '#thing3':
				Y.one(document.body).setStyle('background-color', 'yellow');
				break;
			}
			
			Y.one('#navwrapper #progress').setContent('');
		}
	});
	
	</script>
	<style type="text/css">
	body {
		background-color:black;
	}
	#navwrapper {
		margin-top:20px;
		text-align:center;
		background-color:white;
		padding:20px;
		height:40px;
	}
	#navwrapper a {
		margin-left:10px;
		margin-right:10px;
	}
	#navwrapper #progress {
		font-weight:bold;
	}
	#thingwrapper2 {
		text-align:center;
		margin-top:20px;
		margin-left:auto;
		margin-right:auto;
		position:relative;
	}
	#thingwrapper {
		display:inline-block;
		*display:inline;
		zoom:1;
		border:4px white solid;
		border-radius:5px;
		-moz-border-radius:5px;
		-webkit-border-radius:5px;
	}
	#thingwrapper .thing {
		padding:20px;
		display:block;
		color:white;
		font-size:30px;
	}
	#thingwrapper #thing1 {
		width:400px !important;
		height:150px !important;
		background-color:blue;
	}
	#thingwrapper #thing2 {
		width:600px !important;
		height:300px !important;
		background-color:purple;
	}
	#thingwrapper #thing3 {
		width:500px !important;
		height:500px !important;
		background-color:green;
	}
	#thingwrapper .displaynone {
		display:none !important;
	}
	</style>
</head>
<body>
	<div id="navwrapper">
		<a href = "" id="showthing1">Show Thing 1</a><a href = "" id="showthing2">Show Thing 2</a><a href = "" id="showthing3">Show Thing 3</a>
		<div id="progress"></div>
	</div>
	<div id="thingwrapper2">
		<div id="thingwrapper">
			<div id="thing1" class="thing">
				Thing 1
			</div>
			<div id="thing2" class="thing displaynone">
				Thing 2
			</div>
			<div id="thing3" class="thing displaynone">
				Thing 3
			</div>
		</div>
	</div>
</body>
</html>